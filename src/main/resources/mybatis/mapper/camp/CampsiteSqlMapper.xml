<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bulmeong.basecamp.camp.mapper.CampsiteSqlMapper">
    <insert id="insertCampsite">
        <selectKey resultType="int" keyProperty="id" order="AFTER">
            select max(id) from bc_campsite
        </selectKey>
        INSERT into bc_campsite (
            account,
            password, 
            name,    
            seller,
            address,
            postcode,
            detail_address,
            phone,
            camp_phone,
            email,
            profile_image,
            url,
            description,
            manner_start,
            manner_end,
            check_in,
            check_out,
            notice
        ) values (
            #{account},
            #{password}, 
            #{name},    
            #{seller},
            #{address},
            #{postcode},
            #{detail_address},
            #{phone},
            #{camp_phone},
            #{email},
            #{profile_image},
            #{url},
            #{description},
            #{manner_start},
            #{manner_end},
            #{check_in},
            #{check_out},
            #{notice}
        )
    </insert>
    <insert id="insertCampsiteBank">
        <selectKey resultType="int" keyProperty="id" order="AFTER">
            select max(id) from bc_campsite_bank
        </selectKey>
        INSERT into bc_campsite_bank (
            campsite_id,
            bank_name,
            bank_account,
            holder
        ) 
        values(
            #{campsite_id},
            #{bank_name},
            #{bank_account},
            #{holder}
        )
    </insert>
    
    <insert id="insertPoint">
        insert into bc_campsite_area_point(
            area_id,
            name,
            point_count
        )
        values(
            #{id},
            '새 구역',
            1
        );
    </insert>


    <insert id="insertArea">
        <selectKey resultType="int" keyProperty="id" order="AFTER">
            select max(id) from bc_campsite_area
        </selectKey>
        insert into bc_campsite_area (
            campsite_id,
            name,
            prise,
            size_x,
            size_y,
            map_image,
            description,
            max_people,
            max_car,
            limit_people,
            min_ordertime,
            adult_pay,
            kid_pay,
            car_pay
        ) values 
        (
            #{campsite_id},
            #{name},
            #{prise},
            #{size_x},
            #{size_y},
            #{map_image},
            #{description},
            #{max_people},
            #{max_car},
            #{limit_people},
            #{min_ordertime},
            #{adult_pay},
            #{kid_pay},
            #{car_pay}
        );
    </insert>

    <insert id="insertCampsiteCategory">
        insert into bc_campsite_select_category (campsite_id, category_id) values (#{campsite_id},#{category_id});
    </insert>
    <insert id="insertCampMainImage">
        INSERT into bc_campsite_image (
            campsite_id,
	        location,
	        origin_filename
        )
        values(
            #{campsite_id},
	        #{location},
	        #{origin_filename}
        )
    </insert>

    <update id="updateCampsite">
        UPDATE bc_campsite set
            name = #{name},
            camp_phone = #{camp_phone},
            email = #{email},
            url = #{url},
            description = #{description},
            facility_notice = #{facility_notice},
            refund_notice = #{refund_notice},
            manner_start = #{manner_start},
            manner_end = #{manner_end},
            check_in = #{check_in},
            check_out = #{check_out},
            notice = #{notice},
            map_image = #{map_image},
            adult_pay = #{adult_pay},
            kid_pay = #{kid_pay},
            car_pay = #{car_pay},
            peak_pay = #{peak_pay},
            peak_start_date = #{peak_start_date},
            opentime = #{opentime},
            peak_end_date = #{peak_end_date},
            max_ordertime = #{max_ordertime}
        where id = #{id}
    </update>

    <update id="updateArea">
        UPDATE bc_campsite_area set
            name = #{name},
            prise = #{prise},
            size_x = #{size_x},
            size_y = #{size_y},
            map_image = #{map_image},
            description = #{description},
            max_people = #{max_people},
            max_car = #{max_car},
            limit_people = #{limit_people},
            min_ordertime = #{min_ordertime},
            adult_pay = #{adult_pay},
            kid_pay = #{kid_pay},
            car_pay = #{car_pay}
        where id = #{id}
    </update>

    <update id="authCampSite">
        UPDATE bc_campsite set
            is_authenticated = 'T'
        where id = #{id}
    </update>
    
    <select id="getCampsiteDtoByAccountInfo" resultType="com.bulmeong.basecamp.camp.dto.CampsiteDto">
        select * from bc_campsite where account = #{account} and password = #{password}
    </select>
    <select id="getCampsiteDtoByAccount" resultType="com.bulmeong.basecamp.camp.dto.CampsiteDto">
        select * from bc_campsite where account = #{account}
    </select>
    <select id="getCampsiteDtoByName" resultType="com.bulmeong.basecamp.camp.dto.CampsiteDto">
        select * from bc_campsite where name = #{name}
    </select>
    <select id="getCampsiteDtoById" resultType="com.bulmeong.basecamp.camp.dto.CampsiteDto">
        select * from bc_campsite where id = #{id}
    </select>
    <select id="newCampsiteID" resultType="int">
        select COALESCE(MAX(id) + 1, 1) from bc_campsite
    </select>
    <select id="newAreaIDByCampsiteId" resultType="int">
        select COALESCE(MAX(id) + 1, 1) from bc_campsite_area where campsite_id = #{id}
    </select>
    <select id="pointCountByAreaId" resultType="int">
        select COUNT(*) from bc_campsite_area_point where area_id = #{id}
    </select>
    <select id="getCampsiteCategory" resultType="com.bulmeong.basecamp.camp.dto.CampsiteCategoryDto">
        select * from bc_campsite_category
    </select>
    <select id="getAreaCategory" resultType="com.bulmeong.basecamp.camp.dto.CampsiteCategoryDto">
        select * from bc_campsite_area_category
    </select>
    <select id="getCategoryBySelectCategoryId" resultType="com.bulmeong.basecamp.camp.dto.CampsiteCategoryDto">
        select * from bc_campsite_category where id = #{id}
    </select>
    <select id="getSelectCategoriesByCampsiteId" resultType="int">
        select category_id from bc_campsite_select_category where campsite_id = #{id}
    </select>
    <select id="getAreaList" resultType="com.bulmeong.basecamp.camp.dto.CampsiteAreaDto">
        select * from bc_campsite_area where campsite_id = #{campsite_id}
    </select>
    <select id="getPointList" resultType="com.bulmeong.basecamp.camp.dto.CampsiteAreaPointDto">
        select * from bc_campsite_area_point where area_id = #{area_id}
    </select>
    <select id="getAreaDtoById" resultType="com.bulmeong.basecamp.camp.dto.CampsiteAreaDto">
        select * from bc_campsite_area where id = #{id}
    </select>
    <delete id="deletePoint">
        delete from bc_campsite_area_point where id = #{id}
    </delete>
</mapper>