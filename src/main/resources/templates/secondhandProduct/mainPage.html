<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>BASECAMP</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="shotcut icon" href="/public/img/common/campFire.ico" type="image/x-icon">
    <link rel="stylesheet" href="/public/css/secondHandProductCss/style.css">
    <link rel="stylesheet" href="/public/css/basecamp.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        .floating-btn {
            position: fixed;
            /*위치*/
            bottom: 6rem;
            right: 0.5rem;
            background-color: #28323C;
            color: white;
            border-radius: 1.3rem;
            width: 6.5rem;
            height: 2.8rem;
            padding: 0 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
        }
        /*pc용*/
        @media (min-width: 768px) {
            .floating-btn {
                position: fixed;
                bottom: 6rem; /* PC에서는 조금 더 위쪽에 위치 */
                right: 38.5rem; /* PC에서는 더 안쪽으로 위치 */
                height: 2.8rem;
                border-radius: 1.3rem;
            }
        }
        .floating-btn .plus-icon {
            position: relative;
            top: 0;
            left: 0;
            transform: none;
        }
        /*글쓰기 모달*/
        .floating-menu {
            display: none;
            position: fixed;
            bottom: 9.3rem;
            right: 0.5rem;
            flex-direction: column;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            z-index: 999;
            padding: 0.5rem;
        }
        @media (min-width: 768px) {
            .floating-menu {
                position: fixed;
                bottom: 9.3rem; /* PC에서는 조금 더 위쪽에 위치 */
                right: 38.5rem; /* PC에서는 더 안쪽으로 위치 */
                border-radius: 0.5rem;
            }
        }
        .floating-menu .menu-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
        .floating-menu .menu-item:last-child {
            border-bottom: none;
        }
        .floating-menu .menu-item i {
            margin-right: 0.5rem;
        }
        .floating-menu .menu-item span {
            margin-left: 5px;
        }
        .location-dropdown-menu {
            width: 11rem;
            height: 6rem;
            bottom: 0.5rem !important; /* 드롭다운 위치 */
        }
        .icon-and-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .icon-and-text .icon {
            margin-bottom: 0;
            padding-bottom: 0;
            gap: 0;
        }
        .icon-and-text .text {
            margin-top: 0;
            font-size: 0.8rem;
        }
        .icon-and-text .text-navi {
            font-size: 1.1rem;
            font-weight: 600;
        }
        .king{
            top: -6%;
            left: 83%;
        }
        .floating-btn {
            z-index: 1000;
        }
        .floating-menu {
            z-index: 1000; /* Ensure it's higher than other page elements */
        }
    </style>
</head>
<body>
<!--하단네비-->
<!--구매 하단네비 -->
<div th:fragment="bottomNaviBasecamp" class="container-fluid g-0 border-top bg-white fixed-bottom pb-3">
    <div class="row mx-1 py-2 text-center">

        <!--HOME-->
        <a href="/" class="col icon-and-text">
            <span class="material-symbols-outlined fw-light" style="font-size: 1.8em; color: darkgray;">
                home
            </span>
            <span class="text-navi pt-1" style="font-size: 0.7em; color: darkgray">홈</span>
        </a>

        <!--구매-->
        <div class="col icon-and-text dropdown dropup">
            <span data-bs-toggle="dropdown" class="material-symbols-outlined" style="font-size: 1.7em;">
                storefront
            </span>
            <span class="text-navi pt-1 fw-bold" style="font-size: 0.7em;">구매</span>
            <ul class="dropdown-menu custom-dropdown-menu">
                <!-- 변초연 -->
                <a class="dropdown-item col" href="/store">
                    <div class="row w-100">
                        <div class="col-auto d-flex">
                            <span class="material-symbols-outlined pe-1 ps-1 fw-light">
                                shopping_bag
                            </span>
                            <span style="font-size: 0.9em;">스토어</span>
                        </div>
                    </div>
                </a>
                <!-- 심규진 -->
                <a class="dropdown-item col" href="/secondhandProduct/mainPage">
                    <div class="row w-100">
                        <div class="col-auto d-flex">
                            <span class="material-symbols-outlined pe-1 ps-1 fw-light">
                                eco
                            </span>
                            <span style="font-size: 0.9em;">중고</span>
                        </div>
                    </div>
                </a>
            </ul>
        </div>

        <!--예약-->
        <div class="col icon-and-text dropdown dropup">
            <span data-bs-toggle="dropdown" class="material-symbols-outlined fw-light" style="font-size: 1.7em; color: darkgray">
                event_available
            </span>
            <span class="text-navi pt-1" style="font-size: 0.7em; color: darkgray">예약</span>
            <ul class="dropdown-menu row custom-dropdown-menu">
                <!-- 조준희 -->
                <a class="dropdown-item col" href="/camp/main">
                    <div class="row w-100">
                        <div class="col-auto d-flex">
                            <span class="material-symbols-outlined pe-1 ps-1 fw-light">
                                camping
                            </span>
                            <span style="font-size: 0.9em;">캠핑장</span>
                        </div>
                    </div>
                </a>
                <!-- 양은자 -->
                <a class="dropdown-item col" href="/campingcar/main">
                    <div class="row w-100">
                        <div class="col-auto d-flex">
                            <span class="material-symbols-outlined pe-1 ps-1 fw-light">
                                airport_shuttle
                            </span>
                            <span style="font-size: 0.9em;">캠핑카</span>
                        </div>
                    </div>
                </a>
            </ul>
        </div>

        <!--커뮤-->
        <div class="col icon-and-text dropdown dropup">
            <span data-bs-toggle="dropdown" class="material-symbols-outlined fw-light" style="font-size: 1.7em; color: darkgray">
                forum
            </span>
            <span class="text-navi pt-1" style="font-size: 0.7em; color: darkgray">커뮤니티</span>
            <ul class="dropdown-menu custom-dropdown-menu">
                <!-- 이시은 -->
                <a class="dropdown-item col" href="/club/main">
                    <div class="row w-100">
                        <div class="col-auto d-flex">
                            <span class="material-symbols-outlined pe-1 ps-1 fw-light">
                                group
                            </span>
                            <span style="font-size: 0.9em;">소모임</span>
                        </div>
                    </div>
                </a>
                <!-- 남현지 -->
                <a class="dropdown-item col" href="/insta/instaMainPage">
                    <span>
                        <img src="/public/img/instaImage/campstagram.png" class="img-fluid">
                    </span>
                </a>
            </ul>
        </div>

        <!--내정보-->
        <a class="col icon-and-text" href="/user/login" th:if="${session.sessionUserInfo == null}">
            <span class="material-symbols-outlined pe-1 ps-1 fw-light"style="font-size: 1.7em; color: darkgray;">
                person
            </span>
            <span class="text-navi pt-1" style="font-size: 0.7em; color: darkgray;">마이</span>
        </a>
        <a class="col icon-and-text" href="/user/myPage" th:unless="${session.sessionUserInfo == null}">
            <span class="material-symbols-outlined pe-1 ps-1 fw-light"style="font-size: 1.7em; color: darkgray;">
                person
            </span>
            <span class="text-navi pt-1" style="font-size: 0.7em; color: darkgray;">마이</span>
        </a>
    </div>
</div>
<!--상단네비-->
<div class="container-fluid g-0 bg-white fixed-top">
    <div class="row py-2 mx-2">
        <div class="col-auto icon-and-text dropdown dropup">
            <!-- 초기 지역 -->
            <span data-bs-toggle="dropdown" class="text-navi" th:if="${areaName} == null">
                <span>전체</span>
                <span class="ms-1" style="font-weight: 600"><i class="bi bi-chevron-down"></i></span>
            </span>
            <!-- 지역 선택시 -->
            <span data-bs-toggle="dropdown" class="text-navi" th:if="${areaName} != null">
                <span th:text="${areaName}"></span>
                <span class="ms-1" style="font-weight: 600"><i class="bi bi-chevron-down"></i></span>
            </span>
            <!--            -->
            <ul class="dropdown-menu location-dropdown-menu">
                <li>
                    <!-- 초기 지역 -->
                    <div class="dropdown-item mt-1" th:if="${areaName} == null">
                        <span>전체</span>
                    </div>
                    <!-- 지역 선택시 -->
                    <div class="dropdown-item mt-1" th:if="${areaName} != null">
                        <span th:text="${areaName}"></span>
                    </div>
                </li>
                <li>
                    <div class="dropdown-item mt-2">
                        <a href="/secondhandProduct/administrativeRegionListPage" style="color: black">
                            <span >지역 설정</span>
                        </a>
                    </div>
                </li>
            </ul>
        </div>
        <div class="col"></div>
        <div class="col d-flex align-text-center justify-content-end">
            <a href="/secondhandProduct/myPage">
                <span style="font-size: 1.2rem; color: black">
                    <i class="bi bi-bell"></i>
                </span>
            </a>
        </div>
    </div>
</div>
<div class="container-fluid g-0" style="margin-top: 3.5rem; padding-bottom: 5rem">
    <div class="row mx-2 mb-2">
        <a href="/secondhandProduct/selectCategoryPage" class="col-auto mainPostLink-custom">
            <span class="main-categoryBtn"><span class="me-1"><i class="bi bi-list"></i></span>카테고리</span>
        </a>
    </div>
    <a th:href="@{/secondhandProduct/postDetailsPage(product_id=${productList.product_id}, user_id=${productList.user_id}, polygon_name=${productList.polygon_name})}"
       class="row mx-2 pt-3 pb-2 border-bottom mainPostLink-custom" th:each="productList : ${productDtoList}">
        <div class="col-4" style="height: 7rem;">
            <img class="mainPostImg-custom" style="object-fit: cover; object-position: center" th:src="@{/images/{image}(image=${productList.main_image})}">
        </div>
        <div class="col ps-0">
            <div class="row-auto">
                <div class="col">
                    <span th:text="${productList.title}" class="main-title-font title-line">제목~</span>
                </div>
                <div class="col main-subtitle-font">
                    <span th:text="${productList.category_name}">카테고리</span><span>・</span>
                    <span th:text="${productList.polygon_name}">위치</span><span>・</span>
                    <span th:if="${productList.updated_at != null}"
                          th:text="${T(com.bulmeong.basecamp.common.util.TimeUtil).timeAgo(productList.updated_at)}">수정일</span>
                    <span th:if="${productList.updated_at == null}"
                          th:text="${T(com.bulmeong.basecamp.common.util.TimeUtil).timeAgo(productList.created_at)}">생성일</span>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="col-auto pe-0 me-1" th:if="${session.sessionUserInfo != null and productList.status == '거래완료'}">
                            <span class="border text-center p-1" style="font-size: 0.8rem ;font-weight: 500; background-color: #28323C; color: white" th:text="${productList.status}">거래상태</span>
                        </div>
                        <div class="col ps-0" th:if="${session.sessionUserInfo != null and productList.status == '거래완료'}">
                            <span th:text="|${#numbers.formatInteger(productList.price, 0, 'COMMA')}원|" class="main-price-font">금액</span>
                        </div>
                        <div class="col" th:if="${session.sessionUserInfo != null and productList.status != '거래완료'}">
                            <span th:text="|${#numbers.formatInteger(productList.price, 0, 'COMMA')}원|" class="main-price-font">금액</span>
                        </div>
                    </div>
                </div>
                <div class="col pt-3 text-end main-like-font">
                    <span><i class="bi bi-chat"></i></span><span class="ms-1" th:text="${productList.chat_room_count}">채팅수</span>
                    <span><i class="bi bi-heart"></i></span><span class="ms-1" th:text="${productList.wish_list_count}">좋아요수</span>
                </div>
            </div>
        </div>
    </a>
</div>

<!-- 플로팅 버튼 및 메뉴 -->
<div class="floating-btn noTouch" id="floatingBtn">
    <span class="plus-icon"><i class="bi bi-plus-lg"></i><span class="ps-2">글쓰기</span></span>
</div>
<div class="floating-menu noModal" id="floatingMenu">
    <div class="menu-item" onclick="location.href='/secondhandProduct/productRegistrationPage'">
        <i class="bi bi-pencil"></i><span>내 물건 팔기</span>
    </div>
    <div class="menu-item" onclick="location.href='/secondhandProduct/chatRoomPage'">
        <i class="bi bi-chat-dots"></i><span>채팅</span>
    </div>
    <div class="menu-item" onclick="location.href='/secondhandProduct/myPage'">
        <i class="bi bi-person"></i><span>내정보</span>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/7b271bba58.js" crossorigin="anonymous"></script>
<script>
    let myId = null;
    const urlParams = new URL(window.location.href).searchParams;

    // js 로그인여부
    function setSessionUserId() {
        const url = "/api/user/getSessionUserId"
        fetch(url)
            .then(response => response.json())
            .then((response) => {
                myId = response.data.userId;
            })
        ;
    }
    window.addEventListener("DOMContentLoaded", () => {
        setSessionUserId();
    });

    // 플로팅 버튼을 클릭할 때의 이벤트 리스너
    document.getElementById('floatingBtn').addEventListener('click', function (event) {
        var menu = document.getElementById('floatingMenu');
        console.log(menu);

        // 메뉴가 열려있으면 닫고, 열려있지 않으면 연다
        if (menu.style.display === 'none' || menu.style.display === '') {
            menu.style.display = 'flex';
        } else {
            menu.style.display = 'none';
        }

        event.stopPropagation(); // 이벤트 전파 방지 (다른 클릭 이벤트로 전달되지 않게 함)
    });

    // 화면의 다른 부분을 클릭할 때의 이벤트 리스너
    window.addEventListener('click', function(event) {
        var menu = document.getElementById('floatingMenu');

        // 플로팅 메뉴가 열려 있을 때만 처리
        if (menu.style.display === 'flex') {
            // 클릭한 곳이 플로팅 메뉴 내부나 버튼이 아니라면 메뉴를 닫음
            if (!menu.contains(event.target) && event.target.id !== 'floatingBtn') {
                menu.style.display = 'none';
                event.stopPropagation(); // 이벤트 전파 방지
                event.preventDefault();  // 다른 페이지 이동을 막음
            }
        }
    });

    // 플로팅 메뉴 내부의 링크를 클릭했을 때의 이벤트 리스너
    document.querySelectorAll('#floatingMenu a').forEach(function(link) {
        link.addEventListener('click', function(event) {
            var menu = document.getElementById('floatingMenu');

            // 플로팅 메뉴를 닫고 페이지 이동 허용
            menu.style.display = 'none';
        });
    });

    window.addEventListener('scroll', function() {
        if (window.scrollY === 0) {
            location.reload();
        }
    });
</script>
<script src="/public/js/lockLikeMobile.js"></script>
</body>
</html>

