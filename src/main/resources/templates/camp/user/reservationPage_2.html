<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>BASECAMP</title>
    <link rel="shotcut icon" href="/public/img/common/campFire.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/public/css/common.css">
    <link rel="stylesheet" href="/public/css/basecamp.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css">
    
    <script src="/public/js/util.js"></script>
    <script src="/public/js/camp/user.js"></script>
    <script src="/public/js/lockLikeMobile.js"></script>
    <!-- <script>
        initUser();
    </script> -->
    <style>
        .material-symbols-outlined {
          font-variation-settings:
          'FILL' 0,
          'wght' 400,
          'GRAD' 0,
          'opsz' 24
        }
        .topNaviBasecamp {
            background-color: white;
        }
        .sticky-custom {
            position: -webkit-sticky;
            position: sticky;
            top: 2em; /* 여기에서 높이를 조정합니다 */
            z-index: 1020;
        }
        .scroll-horizontal {
            overflow-x: auto;
            white-space: nowrap;
        }
        .scroll-horizontal .facility {
            display: inline-block;
            width: 5em; /* 필요에 따라 너비를 조정하세요 */
            text-align: center;
            margin-right: 10px; /* 아이템 간 간격 조정 */
        }

        .scrollable-vertical {
            height: 20em;
            overflow-y: auto;
        }

         /* 평상시 탭 스타일 */
         .nav-tabs .nav-link {
            color: #666;
            border-radius: 0;
            width: 100%;
        }

        /* 평상시 탭 호버 스타일 */
        .nav-tabs .nav-link:hover {
            background-color: #e9ecef;
            color: #333;
        }

        /* 눌러졌을 때 탭 스타일 */
        .nav-tabs .nav-link.active {
            background-color: #666;
            color: white;
        }

        /* 평상시 리스트 아이템 스타일 */
        .list-group-item {
            border: 1 solid;
            color: #666;
            border-radius: 0;
            width: 100%;
        }

        /* 리스트 아이템 호버 스타일 */
        .list-group-item:hover {
            background-color: #e9ecef;
            border: 0 solid;
            border-radius: 0;
            color: #333;
        }

        /* 활성화된 리스트 아이템 스타일 */
        .list-group-item.active {
            background-color: #666;
            border: 0 solid;
            border-radius: 0;
            color: white;
        }

        .offcanvas-bottom {
            height: 45% !important; 
            max-height: 45%; 
        }

        .selectPoint {
            background-color: rgb(120, 226, 226);
        }

    </style>
</head>
<body>
<!-- 네비가 추가 됨 -->
<div th:replace="camp/campNavi::topNaviBasecamp"></div>
<div th:replace="camp/campNavi::bottomNaviBasecamp"></div>
<div class="main">
    <div class="container-fluid">
        <form id="finalReservationProcess" action="/camp/finalReservationProcess" method="post">
            <!-- 나머지 헤더 섹션 -->
            <div class="row pt-5">
                <div class="col bg-white border-top">
                    <div class="row">
                        <div class="col">
                            <div class="row mt-3 align-items-center">
                                <div class="col ellipsis">
                                    <span class="fs-4 fw-semibold" th:text="${session.campsiteUser.dto.camp_name}"></span>
                            </div>
                            </div>
                            <div class="row mt-3 align-items-center">
                                <div class="col text-secondary">
                                    <div class="row">
                                        <div class="col-1 text-end">
                                            <i class="bi bi-phone"></i>
                                        </div>
                                        <div class="col-auto ellipsis ms-2">
                                            <span th:text="${session.campsiteUser.dto.camp_phone}">연락처</span>
                                        </div>
                                    </div>
                                    <div class="row mt-1 new-fs-9">
                                        <div class="col-1 text-end">
                                            <i class="bi bi-signpost-2"></i>                               
                                        </div>
                                        <div class="col-auto ellipsis ms-2">
                                            <span th:text="${session.campsiteUser.dto.address} + ' ' + ${session.campsiteUser.dto.detail_address}">주소</span>     
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 정보 작성 -->
            <div class="row mt-3 border-top pt-3">
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <span class="fw-semibold fs-5">예약정보</span>
                        </div> 
                    </div>
                    <div class="row mt-2" >
                        <div class="col" th:if="${session.sessionUserInfo != null}">
                            <div class="row">
                                <div class="col">
                                    <span class="fw-semibold me-4 pe-4">이름</span>
                                    <span th:text="${session.sessionUserInfo.name}"></span>
                                    <input type="hidden" name="customer_name" th:value="${session.sessionUserInfo.name}">
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col">
                                    <span class="fw-semibold me-4 pe-2">연락처</span>
                                    <span th:text="${session.sessionUserInfo.phone}"></span>
                                    <input type="hidden" name="customer_phone" th:value="${session.sessionUserInfo.phone}">
                                </div>
                            </div>
                        </div>
                
                        <div class="col" th:unless="${session.sessionUserInfo != null}">
                            <div class="row my-2 align-items-center">
                                <div class="col-2 p-0 text-end">이름</div>
                                <div class="col">
                                    <input class="form-control" id="customer_name" type="text" name="customer_name" placeholder="예약자 이름" required>
                                </div>
                            </div>
                            <div class="row my-2 align-items-center">
                                <div class="col-2 p-0 text-end">연락처</div>
                                <div class="col">
                                    <input class="form-control " id="customer_phone" type="text" name="customer_phone" placeholder="예약자 연락처" oninput="formatPhoneNumber(this)" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-auto">
                            <span class="fw-semibold">예약일</span>
                        </div> 
                        <div class="col ms-3 ps-1">
                            <span th:text="${param.selectDay_start_date}"></span> ~ <span th:text="${param.selectDay_end_date}">2024-08-14</span>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-auto">
                            <span class="fw-semibold">기본 인원</span><span class="ms-4 ps-2" th:text="${session.curArea.dto.max_people}"></span>
                        </div> 
                    </div>
                    <div class="row mt-1">
                        <div class="col-auto">
                            <span class="fw-semibold">초과 인원</span>
                        </div> 
                        <div class="col ms-3 ps-1">
                            <span class="fw-semibold">성인</span><span class="ms-2" th:text="${param.adult}"></span>
                            <span class="fw-semibold ms-4">미성년자</span><span class="ms-2" th:text="${param.kid}"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 차량 -->
            <div class="row border-bottom border-5 mt-2 pb-4">
                <div class="col" th:if="${car > 0}">
                    <div class="row my-2 align-items-center" th:each="i : ${#numbers.sequence(1, car)}">
                        <div class="col-2 p-0 text-end new-fs-9">차량번호</div>
                        <div class="col">
                            <input class="form-control carList" type="text" name="car_number" placeholder="차량번호 입력" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 배치도 -->
            <div class="row mt-3 flex-column border-bottom border-5 pb-5">
                <div class="col">
                    <span class="fw-semibold fs-5">포인트 배치도</span>
                </div> 
                <div class="col mt-4">
                    <img class="img-fluid rounded-3" th:src="'/images/' + ${session.curArea.dto.map_image}" alt="">
                </div>
            </div>

            <!-- 포인트 리스트 -->
            <div class="row mt-3 flex-column border-bottom border-5 pb-5">
                <div class="col">
                    <span class="fw-semibold fs-5">포인트 선택</span>
                </div>
                <div class="col mt-1">
                    <span class="new-fs-9 text-secondary">칸의 위치는 실제 장소의 위치와 연관이 없습니다.<br>
                    배치도에 보여지는 이름과 같은 포인트로 배정됩니다.</span>
                </div>
                <div class="col mt-3">
                    <div id="pointList">
                    
                    </div>
                </div>
            </div>

            <!-- 약관 동의 -->
            <div class="row mt-4">
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <span class="fw-semibold fs-5">약관</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <span class="new-fs-9 text-secondary">예약을 하기 위해서는 결제약관에 동의하셔야합니다.</span>
                        </div>
                    </div>
                    <div class="row mt-3 border-bottom border-5 pb-5">
                        <div class="col mx-3 border rounded-2 mt-2 py-2">
                            <div class="row">
                                <div class="col scrollable-vertical ">
                                    <h5>1. 개요</h5>
                                    <p>이 결제 약관(이하 "약관")은 베이스 캠프(이하 "회사")와 회사의 상품 및 서비스(이하 "서비스")를 구매하는 고객(이하 "고객") 간의 결제와 관련된 조건을 규정합니다. 고객은 회사의 서비스를 구매함으로써 이 약관에 동의하게 됩니다.</p>
                                    <br>
                                    <h5>2. 결제 방법</h5>
                                    <p>고객은 다음과 같은 결제 방법을 사용할 수 있습니다:</p>
                                    <ul>
                                        <li>신용카드 및 직불카드</li>
                                        <li>은행 송금</li>
                                        <li>전자 지갑 및 결제 서비스 (예: 페이팔, 카카오페이 등)</li>
                                        <li>기타 회사가 제공하는 결제 수단</li>
                                    </ul>
                                    <br>
                                    <h5>3. 결제 조건</h5>
                                    <p>모든 결제는 즉시 처리되며, 서비스 제공 전에 완료되어야 합니다.</p>
                                    <p>서비스의 가격은 결제 시점의 가격으로 결정되며, 이는 회사의 웹사이트에 명시된 가격을 따릅니다.</p>
                                    <p>모든 결제는 대한민국 원(KRW)으로 이루어지며, 외화 결제의 경우 환율 변동에 따라 추가 비용이 발생할 수 있습니다.</p>
                                    <br>
                                    <h5>4. 세금 및 수수료</h5>
                                    <p>고객은 결제 시 발생하는 모든 세금 및 수수료(부가가치세, 송금 수수료 등)를 부담해야 합니다.</p>
                                    <p>회사는 서비스 가격에 포함된 세금 및 수수료를 명시적으로 표시합니다.</p>
                                    <br>
                                    <h5>5. 환불 정책</h5>
                                    <p>고객은 결제 후 7일 이내에 환불을 요청할 수 있습니다. 단, 이미 제공된 서비스나 디지털 콘텐츠의 경우 환불이 불가능합니다.</p>
                                    <p>환불 요청은 고객 지원 팀을 통해 접수되며, 환불 절차는 접수 후 14일 이내에 완료됩니다.</p>
                                    <p>고객의 요청으로 인한 환불의 경우 환불 처리 수수료가 부과될 수 있습니다.</p>
                                    <br>
                                    <h5>6. 지불 지연 및 불이행</h5>
                                    <p>고객이 결제를 지연하거나 불이행할 경우, 회사는 서비스 제공을 중단하거나 지연할 수 있습니다.</p>
                                    <p>지불 지연 시, 회사는 연체 이자를 부과할 권리가 있으며, 이율은 법정 최고 이자율을 따릅니다.</p>
                                    <br>
                                    <h5>7. 개인정보 보호</h5>
                                    <p>회사는 결제 과정에서 수집된 고객의 개인정보를 안전하게 보호하며, 개인정보 보호법 등 관련 법령을 준수합니다.</p>
                                    <p>회사의 개인정보 처리방침은 회사의 웹사이트에서 확인할 수 있습니다.</p>
                                    <br>
                                    <h5>8. 약관의 변경</h5>
                                    <p>회사는 필요에 따라 이 약관을 변경할 수 있으며, 변경된 약관은 회사의 웹사이트에 게시된 시점부터 효력을 가집니다.</p>
                                    <p>고객은 약관 변경 후 서비스를 계속 이용함으로써 변경된 약관에 동의하는 것으로 간주됩니다.</p>
                                    <br>
                                    <h5>9. 문의</h5>
                                    <p>결제와 관련된 문의사항은 고객 지원 팀으로 연락해주시기 바랍니다.</p>
                                    <ul>
                                        <li>이메일: support@basecamp.com</li>
                                        <li>전화: 02-1234-5678</li>
                                    </ul>
                                    <br>
                                    <h5>10. 준거법 및 관할</h5>
                                    <p>이 약관은 대한민국 법률에 따라 해석되며, 약관과 관련된 모든 분쟁은 대한민국 법원의 전속 관할로 합니다.</p>
                                </div>
                            </div>
                            <div class="row mt-3 ms-1">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="T" id="agreeTerms">
                                    <label class="form-check-label" for="agreeTerms">
                                        약관에 동의합니다.
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 결제 방법 -->
            <div class="row mt-3 border-bottom border-5 pb-4">
                <div class="col">
                <div class="row">
                    <div class="col">
                        <span class="fw-semibold fs-5">결제 옵션 선택</span>
                    </div>
                </div>
                <div class="row">
                        <div class="col mt-3">
                            <select id="selectPay" class="form-select" aria-label="Default select example">
                                <option value="0">선택해주세요</option>
                                <option selected value="1">카카오페이</option>
                                <option value="2">핸드폰 결제</option>
                                <option value="3">카드 결제</option>
                                <option value="4">무통장 입금</option>
                            </select>
                        </div>
                </div>
                <div class="row" th:if="${session.sessionUserInfo != null}">
                    <div class="col mt-5">
                        <div class="row">
                            <div class="col"><span class="fw-semibold">내 마일리지</span> <span class="ms-2" th:text="${session.sessionUserInfo.mileage}"></span></div>
                        </div>
                        <div class="row mt-2">
                            <div class="col">
                                <span>마일리지 사용</span>
                                <input id="inputMileage" class="form-control mt-2" type="number" name="useMileage" value="0">
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
            <!-- 결제 가격 -->
            <div class="row mt-3 pb-2 px-0 new-fs-9">
                <div class="col">
                    <div class="row">
                        <div class="col ms-2">
                            <span class="fw-semibold fs-5">가격</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col mt-1 text-end pe-3">
                            <span class="fw-semibold">기본 대여비</span>
                            <span class="moneyInput ms-3" th:text="${session.curArea.dto.prise}"></span>
                            <span class="ms-2">원</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col mt-1 text-end pe-3" th:if="${(session.campsiteUser.dto.adult_pay * adult) > 0}">
                            <span class="fw-semibold">초과 성인 요금</span>
                            <span class="moneyInput ms-3"  th:text="${session.campsiteUser.dto.adult_pay * adult}"></span>
                            <span class="ms-2">원</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col mt-1 text-end pe-3" th:if="${(session.campsiteUser.dto.kid_pay * kid) > 0}">
                            <span class="fw-semibold">초과 미성년자 요금</span>
                            <span class="moneyInput ms-3"  th:text="${session.campsiteUser.dto.kid_pay * kid}"></span>
                            <span class="ms-2">원</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col mt-1 text-end pe-3" th:if="${(session.campsiteUser.dto.car_pay * car) > 0}">
                            <span class="fw-semibold">초과 차량 요금</span>
                            <span class="moneyInput ms-3"  th:text="${session.campsiteUser.dto.car_pay * car}"></span>
                            <span class="ms-2">원</span>
                        </div>
                    </div>
                    <div class="row" th:if="${session.sessionUserInfo != null}">
                        <div class="col mt-1 text-end pe-3 text-primary">
                            <span class="fw-semibold">마일리지 사용</span>
                            <span class="moneyInput ms-3" id="useMileage">0</span>
                            <span class="ms-2">원</span>
                        </div>
                    </div>
                    <div class="row" th:if="${saleInfo != null}">
                        <div class="col mt-1 text-end pe-3 text-primary">
                            <span class="fw-semibold">할인</span>
                            <span class="ms-1 fw-semibold" id="saleRate">(10%)</span>
                            <span class="moneyInput ms-3" id="salePrise"></span>
                            <span class="ms-2">원</span>
                        </div>
                    </div>
                    <div class="row border-top mx-0 mt-2 pt-1 fs-5 px-0">
                        <div class="col mt-2 text-end pe-1">
                            <span class="fw-semibold">총</span>
                            <span class="moneyInput ms-3" id="totalPrise"></span>
                            <span class="ms-2">원</span>
                        </div>
                    </div>
                </div> 
            </div>
            <div class="row mt-5 pb-2 justify-content-center">
                <div class="col d-grid px-0 mx-5">
                    <button class="btn btn-primary" type="button" onclick="onPayment()">결제하기</button>
                    
                </div>
            </div> 
            <div class="row my-5"></div>

            <!-- 히든 inputs -->
            <input type="hidden" id="point_id" name="point_id">
            <input type="hidden" id="totalPriseInput" name="total_prise">
            <input type="hidden" name="origin_prise" th:value="${session.curArea.dto.prise}">
            <input type="hidden" id="saleRateInput" name="sale">
            <input type="hidden" id="numberInput" name="number">
            <input type="hidden" name="start_date" th:value="${param.selectDay_start_date}">
            <input type="hidden" name="end_date" th:value="${param.selectDay_end_date}">
            <input type="hidden" id="adult_count" name="adult_count" th:value="${param.adult}">
            <input type="hidden" id="kid_count" name="kid_count" th:value="${param.kid}">
            <input type="hidden" name="adult_pay" th:value="${session.campsiteUser.dto.adult_pay}">
            <input type="hidden" name="kid_pay" th:value="${session.campsiteUser.dto.kid_pay}">
            <input type="hidden" name="car_pay" th:value="${session.campsiteUser.dto.car_pay}">

        </form>
        <div class="row py-2 bg-dark-subtle text-white text-center f09">
            <form id="logoutForm" action="/user/logoutProcess" class="col fw-bold border-end">
                <button class="border-0 bg-transparent text-white fw-bold">
                    <span th:if="${session.sessionUserInfo != null}">로그아웃</span>
                    <span th:if="${session.sessionUserInfo == null}">로그인</span>
                </button>
            </form>
            <div class="col fw-bold border-end">
                고객센터
            </div>
            <div class="col fw-bold">
                NEWS
            </div>
        </div>
        <div class="row py-4 px-3 bg-body-secondary text-secondary">
            <div class="col">
                <div class="row pb-2">
                    <div class="col-auto p-0">
                        <span class="material-symbols-outlined f20">
                            camping
                        </span>
                    </div>
                    <div class="col p-0 fw-bold fs-3">
                        <span>&nbsp;BASECAMP</span>
                    </div>
                </div>
                <div class="row pb-3 border-bottom border-2">
                    <div class="col p-0 f08">
                        BASECAMP는 통신판매 중개자로서 통신판매의 당사자가 아니며 상품의 예약, 이용 및 환불 등과 관련한 의무와 책임은 각 판매자에게 있습니다.
                    </div>
                </div>

                <div class="row pt-3 py-3 border-bottom border-2">
                    <div class="col-auto p-0">
                        <button class="btn btn-sm bg-dark-subtle text-white fw-bold f08 d-flex align-items-center">
                            <span class="material-symbols-outlined f12">
                                phone_in_talk
                            </span>
                            <span>&nbsp;고객센터</span>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-sm bg-dark-subtle text-white fw-bold f08">
                            카카오 1:1 문의
                        </button>
                    </div>
                    <div class="col p-0 f08">
                        <div class="row">
                            <div class="col">
                                <span>평일</span> : 10:00 ~ 17:00
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <span>점심</span> : 12:00 ~ 13:00
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                * 주말 공휴일 휴무
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row pt-3 align-items-center">
                    <div class="col-auto me-2 bg-dark-subtle rounded-circle d-flex align-items-center" style="aspect-ratio: 1/1;">
                        <i class="bi bi-google-play"></i>
                    </div>
                    <div class="col-auto me-2 bg-dark-subtle rounded-circle d-flex align-items-center" style="aspect-ratio: 1/1;">
                        <i class="bi bi-youtube"></i>
                    </div>
                    <div class="col-auto me-2 bg-dark-subtle rounded-circle d-flex align-items-center" style="aspect-ratio: 1/1;">
                        <i class="bi bi-instagram"></i>
                    </div>
                    <div class="col-auto pe-0 f08">
                        이용약관
                    </div>
                    <div class="col f08">
                        개인정보처리방침
                    </div>
                </div>
                <div class="row py-5"></div>
                <div class="row py-2"></div>
            </div>
        </div>
    </div>
    
    <div th:replace="camp/campNavi::bottomNaviOffCanvas"></div>
</div>




<div th:replace="camp/campNavi::popupCategory"></div>
<div th:replace="common/navi::popup"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/7b271bba58.js" crossorigin="anonymous"></script>
<script>
    let selectedPoint;
    let selectedNumber;
    let saleInfo;
    let selectedCamp;

    initUser();
    function selectPoint(number, point_id, realPointID) {
        //실제 포인트 고유번호 input에 추가    
        document.getElementById('point_id').value = realPointID;
        const url =`/api/camp/selectPoint?point_id=${point_id}&number=${number}`;
        fetch(url)
        .then(response => response.json())
        .then((response) => {
            let pointTemplate = document.querySelector('.selectPoint');
            if(pointTemplate != null){
                pointTemplate.classList.remove('selectPoint');
            } 
            selectedPoint = response.data.pointList;
            selectedNumber = number;
            pointTemplate = document.getElementById(`point_${point_id}_${number}`);
            console.log(`point_${point_id}_${number}`);
            pointTemplate.classList.add('selectPoint');
        });
    }
    function initPointList() {
        function dateGet(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 +1
            const day = String(date.getDate()).padStart(2, '0');

            const formattedDate = `${year}-${month}-${day}`;
            return formattedDate;
        }
        const pointList = document.getElementById('pointList');
        // 현재 페이지의 URL을 가져옵니다.
        const urlParams = new URLSearchParams(window.location.search);
        const id = parseInt(urlParams.get('area_id'));
        const startDate = new Date(urlParams.get('selectDay_start_date'));
        const endDate = new Date(urlParams.get('selectDay_end_date'));
        let url ='/api/camp/selectArea?area_id=' + id;
        let deleteValue = 0;
        fetch(url)
        .then(response => response.json())
        .then((response) => {
            const curArea = response.data.curAreaUser;
            url = `/api/camp/isAlreadyOrderPointList?area_id=${id}&startDate=${dateGet(startDate)}&endDate=${dateGet(endDate)}`;
            fetch(url)
            .then(response => response.json())
            .then((response) => {
                const alreadyOrdered = response.data.isAlreadyOrdered;
                for(const point of curArea.pointInfo.point) {
                    const row = document.createElement('div');
                    row.classList.add("row", "ms-1", "mt-1", "pb-1");
                    const name = document.createElement('span');
                    name.classList.add('fw-semibold','ps-0','mb-2');
                    name.innerText = point.name;
                    row.appendChild(name);
                    let url =`/api/camp/selectPoint?point_id=${point.point_id}&number=0`;
                    fetch(url)
                    .then(response => response.json())
                    .then((response) => {
                        const list = response.data.pointList;
                        console.log(list);
                        for(let i = 0; i < list.length; i++) {
                            const container = document.createElement('div');
                            container.classList.add('col-auto','border','py-2','px-2','mb-2','ms-1');
                            container.innerText = i+1;
                            container.id = `point_${point.point_id}_${i+1}`
                            if(alreadyOrdered.includes(list[i].id)){
                                container.classList.add('bg-secondary');
                            }
                            else{
                                container.onclick=function(){selectPoint(i+1, point.point_id,list[i].id)};
                            }
                            row.appendChild(container);
                        }
                        pointList.appendChild(row);
                    });
                }
              
                });
        });
    }
    function initSelect() {
        const param = new URLSearchParams(window.location.search).get('area_id');
        if(param == null || param == '0') return;
        const id = parseInt(param);
        const url ='/api/camp/selectArea?area_id=' + id;
        fetch(url)
        .then(response => response.json())
        .then((response) => {
            curArea = response.data.curAreaUser;
            selectedCamp = response.data.campsiteUser;
            refreshTotalPrise();
        });
    }
    function refreshTotalPrise() {
        const totalPrise = document.getElementById('totalPrise');
        const curArea = currentArea();
        let totalValue= curArea.dto.prise;
        
        const adults = parseInt(new URLSearchParams(window.location.search).get('adult'));
        const kids = parseInt(new URLSearchParams(window.location.search).get('kid'));
        const cars = parseInt(new URLSearchParams(window.location.search).get('car'));
        const mileageInput = document.getElementById('useMileage');
        let mileage = 0;
        if(mileageInput != null && mileageInput.innerText != null){
            let mileageValue = parseInt(document.getElementById('useMileage').innerText.replace(',',''));
            mileage = mileageValue;
        }
        const curCamp = selectedCamp;
        const carValue = curCamp.dto.car_pay * cars;
        const kidValue = curCamp.dto.kid_pay * kids;
        const adultValue = curCamp.dto.adult_pay * adults;
       
        totalValue = totalValue + adultValue + kidValue + carValue;
        totalValue -= mileage;
       
        totalPrise.innerText = totalValue;
        addColonMoneyInput();
        return totalValue;
    }

    function onPayment() {
    const finalReservationProcess = document.getElementById('finalReservationProcess');
    const terms = document.getElementById('agreeTerms');
    const customer_name = document.getElementById('customer_name');
    const customer_phone = document.getElementById('customer_phone');

    if (customer_name && (customer_name.value === '' || customer_phone.value === '')) {
        alert('예약자 정보를 입력해주세요.');
        customer_name.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }

    const carList = document.getElementsByClassName('carList');
    for (const carInfo of carList) {
        if (carInfo.value === '') {
            alert('차량 번호를 입력해주세요.');
            carInfo.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return;
        }
    }

    if (!terms.checked) {
        alert('결제약관에 동의하셔야 결제를 진행할 수 있습니다.');
        terms.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }

    if (selectedPoint == null) {
        alert('이용하실 포인트를 선택해주세요.');
        document.getElementById('pointList').scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }

    const selectPay = document.getElementById('selectPay');
    if (selectPay.value === '0') {
        alert('결제 방법을 선택해주세요.');
        selectPay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }

    document.getElementById('numberInput').value = selectedNumber;
    document.getElementById('totalPriseInput').value = refreshTotalPrise();
    document.getElementById('saleRateInput').value = 0;

    if (selectPay.value === '1') {
        const formData = new FormData(finalReservationProcess);
        const url = '/api/camp/payReady';
        
        fetch(url, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(response => {
            function isMobile() {
                return /Mobi|Android/i.test(navigator.userAgent);
            }

            if (isMobile()) {
                location.href = response.data.readyResponse.next_redirect_app_url;
            } else {
                location.href = response.data.readyResponse.next_redirect_pc_url;
            }
           
        })
        .catch(error => console.error('Error:', error));
    } else {
        finalReservationProcess.submit();
    }
}


    const inputMileage =  document.getElementById('inputMileage');
    if(inputMileage != null){
        inputMileage.addEventListener('input', function (e) {
            onMileageInput(e);
        });
    }
    function onMileageInput(e) {
        if(currentUser() == null) {
            checkLogin();
            return;
        }
        const user = currentUser();
        let number = e.target.value;
        if(number > user.mileage) { //마일리지 일정 이상
            number = user.mileage;
            inputMileage.value = user.mileage;
        }
        const mileage = document.getElementById('useMileage');
        number = number <= 0 ? 0 : number;
        mileage.innerText = number;
        refreshTotalPrise();
    }
    
    initSelect();
    initSession();
    initPointList();
</script>
</body>
</html>

