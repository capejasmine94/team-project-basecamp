<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <title>campstagram</title>

    <!-- <script src="/public/js/util.js"></script> -->
    
    <script>
        const urlParams = new URL(window.location.href).searchParams;
        const articleId = urlParams.get("article_id");

        // myId =  session아이디 _ 글로벌 변수 
        let myId = null;

        function setSessionId(){
            const url = "/api/user/getSessionUserId";
            fetch(url)
            .then(response => response.json())
            .then((response) => { // 응답 받은 시점

                myId = response.data.userId;
                reloadHeart();
                console.log("Session ID has been set:", myId); // 콘솔에 찍힐 세션 id
            });
        }

        function like(){
            const url = "/api/insta/like?article_id=" + articleId;
            if(myId == null){
                if(confirm("로그인 후 이용부탁드립니다. 로그인 페이지로 이동하시겠습니까?")){
                    location.href = "/insta/instaLoginPage";
                }
                return;
            }

            fetch(url)
                .then(response => response.json())
                .then(response => {
                    reloadHeart();
                })
                ;
        }

        function reloadHeart() {
            if(myId == null){
                return;
            }
            
            const url = "/api/insta/isLiked?article_id=" + articleId;
            fetch(url)
                .then(response => response.json())
                .then(response => {

                    const heart = document.getElementById("heart");

                    if(response.data.isLiked == true){ // 내가 이 article에 좋아요를 누른거
                        heart.classList.remove("bi-heart"); // 'fa-regular fa-heart' => 공백 제거를 위해 쉼표로 나눠서 작성
                        heart.classList.add("bi-heart-fill");

                        heart.onclick = unLike;
                    }else{ // 좋아요 안 누른거
                        heart.classList.remove("bi-heart-fill");
                        heart.classList.add("bi-heart");

                        heart.onclick = like;
                    }
                })
                ;

        }

        function unLike(){

            if(myId == null){
                if(confirm("로그인 후 이용부탁드립니다. 로그인 페이지로 이동하시겠습니까?")){
                    location.href = "/insta/instaLoginPage";
                }
                return;
            }

            const url = "/api/insta/unLike?article_id=" + articleId;

            fetch(url)
            .then(response => response.json())
            .then(response => {
                reloadHeart();
            })
            ;
        }

        window.addEventListener("DOMContentLoaded", () => {
            // 페이지 로드 후 사실상 시작 지점
            setSessionId();

        });

        
        function action(){
            alert("껄끄럽네~")
        }
    </script>
    <style>
        /* 고정 */
        .fontBasic {
            font-size: 0.8em;
        }

        /* 상단바 높이 */
        .fixed-top {
            text-align: center;
            justify-content: space-around; /* 가로 중앙 정렬 */
            align-items: center; /* 세로 중앙 정렬 */
            height: 50px; /* 원하는 높이로 설정 */
        }
        .fixed-bottom {
            text-align: center;
            justify-content: space-around; /* 가로 중앙 정렬 */
            align-items: center; /* 세로 중앙 정렬 */
            height: 70px; /* 원하는 높이로 설정 */
        }

        /* 이미지 크기 */
        .storyImage {
            width: 60px;  /* 원하는 너비 */
            height: 60px; /* 원하는 높이 */
            object-fit: cover; /* 이미지가 요소를 채우도록 조정 */
        }
        .profileImage {
            width: 35px;  /* 원하는 너비 */
            height: 35px; /* 원하는 높이 */
            object-fit: cover; /* 이미지가 요소를 채우도록 조정 */
        }
        .commentImage {
            width: 20px;  /* 원하는 너비 */
            height: 20px; /* 원하는 높이 */
            object-fit: cover; /* 이미지가 요소를 채우도록 조정 */
        }

        .instaButtonColor {
            color: #0095f6;
        }

        /* 검색창 */
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        .search-container input {
            padding-left: 30px; /* 아이콘을 위한 여유 공간 */
            border-radius: 10px; /* 모서리를 더 둥글게 만들기 */
        }
        .search-container .bi-search {
            position: absolute;
            left: 10px;
            color: gray;
        }

        /* 글쓰기 버튼 */
        .write-button-container {
            position: fixed; /* 페이지의 특정 위치에 고정할 수 있음 */
            bottom: 100px; /* 원하는 위치로 조정 가능 */
            right: 20px;  /* 원하는 위치로 조정 가능 */  
            border-radius: 3px;
            z-index: 1000; /* 다른 요소들보다 위에 위치하도록 설정 */
        }
        /* .write-button {
            border: 1px solid #ccc; 경계선 추가
            border-radius:4px;
            padding: 0%;
            display: flex;
        } */

        /* 이미지 하단 사진 개수 */
        /* Bootstrap Carousel 기본 스타일을 유지하면서 점 모양 인디케이터 스타일링 */
        .carousel-indicators {
            bottom: 1px; /* 인디케이터 위치 조정 */
        }

        .carousel-indicators .active {
            background-color: #fff; /* 활성화된 점 색상 설정 (흰색) */
        }

        /* 인디케이터 숫자 제거 */
        .carousel-indicators li {
            list-style: none; /* 기본 리스트 스타일 제거 */
            width: 6px; /* 점의 너비 */
            height: 6px; /* 점의 높이 */
            background-color: #dbdada93; /* 점의 색상 */
            border-radius: 50%; /* 둥근 점 모양 */
            margin: 0 2px; /* 점 사이 간격 */
            cursor: pointer; /* 클릭 가능 표시 */
            display: inline-block; /* 인라인 블록으로 나란히 배치 */
        }
    </style>

</head>
<body>    
    <div th:replace="~{common/navi::popup}"></div>
    <div class="container">
        <!-- 상단바 -->
        <div class="row mb-5 pb-2">
            <div class="col">
                <div class="row border-bottom fixed-top px-2" style="background-color: white;">
                    <div class="col-1 pe-0 fs-1">
                        <i class="fa-brands fa-square-instagram" style="color: #E1306C;"></i>
                    </div>
                    <div class="col search-container">
                        <i class="bi bi-search ps-2"></i>         
                        <input value="" name="searchWord" type="text" class="form-control form-control-sm" placeholder="검색">
                    </div>    
                </div>
            </div>
        </div>

        <!-- 스토리 -->
        <!-- overflow-x: auto; 이 클래스가 적용된 요소는 내용이 요소의 크기를 초과할 때, x축 방향으로 스크롤할 수 있게 됩니다. -->
        <div class="row border-bottom pb-1 mb-3" >
            <!-- 스크롤 바 없애는 거 scrollbar-width: none; _ overflow있는 곳에 넣어주기 -->
            <div class="col overflow-x-auto" style="scrollbar-width: none;">
                <div class="row" style="width: 150%;">
                    <a class="col-auto link-dark link-offset-2 link-underline link-underline-opacity-0 " th:href="@{./instaMyPage(user_id=${instaUserInfoDto.id})}">
                        <div class="row">
                            <!-- <div class="col">
                                <img class="rounded" th:src="|/bowWow_image/${e.productDto.product_main_img_link}|" style="height: 7em; width: 100%;" >
                            </div> -->

                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <!-- <img th:src="|/basecampImage/${instaUserInfoDto.insta_profile_img}|" class="img-fluid rounded-circle storyImage"> -->
                                        <img src="/public/img/instaImage/hahaha4.jpg" class="img-fluid rounded-circle storyImage">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col px-1 text-center" style="font-size: 0.8em;">
                                        <span th:text="${instaUserInfoDto.insta_nickname}">닉네임</span>                                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>

                    <a class="col-auto link-dark link-offset-2 link-underline link-underline-opacity-0 " href="./instaUserPage">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <img src="/public/img/instaImage/userImg.jpeg" class="img-fluid rounded-circle storyImage" alt="Profile Image">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col px-1 text-center" style="font-size: 0.8em;">
                                        <span>닉네임</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    <a class="col-auto link-dark link-offset-2 link-underline link-underline-opacity-0 " href="./instaUserPage">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <img src="/public/img/instaImage/userImg.jpeg" class="img-fluid rounded-circle storyImage" alt="Profile Image">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col px-1 text-center" style="font-size: 0.8em;">
                                        <span>닉네임</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    <a class="col-auto link-dark link-offset-2 link-underline link-underline-opacity-0 " href="./instaUserPage">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <img src="/public/img/instaImage/userImg.jpeg" class="img-fluid rounded-circle storyImage" alt="Profile Image">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col px-1 text-center" style="font-size: 0.8em;">
                                        <span>닉네임</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    <a class="col-auto link-dark link-offset-2 link-underline link-underline-opacity-0 " href="./instaUserPage">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <img src="/public/img/instaImage/userImg.jpeg" class="img-fluid rounded-circle storyImage" alt="Profile Image">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col px-1 text-center" style="font-size: 0.8em;">
                                        <span>닉네임</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    <a class="col-auto link-dark link-offset-2 link-underline link-underline-opacity-0 " href="./instaUserPage">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <img src="/public/img/instaImage/userImg.jpeg" class="img-fluid rounded-circle storyImage" alt="Profile Image">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col px-1 text-center" style="font-size: 0.8em;">
                                        <span>닉네임</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- 게시글 List 출력 -->
        <div class="row mb-4" th:each="instaArticleList : ${instaArticleListAll}">
            <div class="col">
                <div class="row">
                    <!-- 글 작성한 사람 프로필 이미지 -->
                    <a class="col-auto pe-1 link-dark link-offset-2 link-underline link-underline-opacity-0"
                                th:href="${session.sessionUserInfo.id == instaArticleList.instaUserInfoDto.user_id} ?
                                            @{./instaMyPage(user_id=${instaArticleList.instaUserInfoDto.id})} : @{./instaUserPage(user_id=${instaArticleList.instaUserInfoDto.id})}">
                        <!-- <img th:src="|/basecampImage/${instaArticleList.instaArticleDto.insta_profile_img}|" class="img-fluid rounded-circle commentImage"> -->
                        <img src="/public/img/instaImage/hahaha4.jpg" class="img-fluid rounded-circle profileImage">
                    </a>
                    <!-- 글 작성한 사람 닉네임 -->
                    <a class="col-auto ps-0 pt-1 link-dark link-offset-2 link-underline link-underline-opacity-0"
                                th:href="${session.sessionUserInfo.id == instaArticleList.instaUserInfoDto.user_id} ?
                                            @{./instaMyPage(user_id=${instaArticleList.instaUserInfoDto.id})} : @{./instaUserPage(user_id=${instaArticleList.instaUserInfoDto.id})}">
                        <span th:text="${instaArticleList.instaUserInfoDto.insta_nickname}" style="font-size: 0.8em;"></span>
                    </a>
                    <div class="col text-end align-self-center">
                        <span>
                            <i class="bi bi-three-dots"></i>
                        </span>
                    </div>
                </div>

                <!-- 해당글 이미지 List -->
                <div class="row mt-3">
                    <div class="col px-0">
                        <div th:id="'carouselExampleInterval' + ${instaArticleList.instaArticleDto.id}" class="carousel slide"> <!-- data-bs-ride="carousel" _ 자동 슬라이드를 활성화 -->
                            <!-- 인디케이터 추가 -->
                            <ol class="carousel-indicators">
                                <!-- 이미지 개수만큼 점 생성 -->
                                <li th:each="image, iterStat : ${instaArticleList.instaArticleImgDtoList}"
                                    th:classappend="${iterStat.index == 0 ? 'active' : ''}"
                                    th:data-bs-slide-to="${iterStat.index}"></li>
                                    <!-- iterStat은 Thymeleaf에서 반복문을 사용할 때 제공되는 변수로, 반복 상태를 나타내는 객체입니다.
                                        iterStat을 사용하면 반복문에서 현재 반복의 상태를 추적하고, 인덱스나 반복 횟수와 같은 정보를 얻을 수 있습니다. -->
                            </ol>
                            
                            <div class="carousel-inner">
                                <!-- 이미지도 반복문 -->
                                <div th:each="image, iterStat : ${instaArticleList.instaArticleImgDtoList}"
                                     class="carousel-item"
                                     th:classappend="${iterStat.index == 0 ? 'active' : ''}"> <!-- data-bs-interval="5000" _ 5초에 한번씩 사진 슬라이드 -->
                                     <!-- 타임리프에서 classappend라는 구문을 사용하여 HTML 요소의 class 속성에 동적으로 클래스를 추가할 수 있습니다. -->
                                    <img th:src="|/images/${image.img_link}|" class="d-block w-100">
                                </div>
                            </div>
                            
                            <button class="carousel-control-prev" type="button" th:data-bs-target="'#carouselExampleInterval' + ${instaArticleList.instaArticleDto.id}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" th:data-bs-target="'#carouselExampleInterval' + ${instaArticleList.instaArticleDto.id}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 잘못 만든거 -->
                <!-- <div class="row mt-3">
                    <div class="col px-0">
                        <div th:id="'carouselExampleInterval' + ${instaArticleList.instaArticleDto.id}" class="carousel slide"> 

                            <ol class="carousel-indicators">
                                
                                <li th:each="image, iterStat : ${instaArticleList.instaArticleImgDtoList}"
                                    th:classappend="${iterStat.index == 0 ? 'active' : ''}"
                                    th:data-bs-slide-to="${iterStat.index}"></li>
                            </ol>
                            
                            <div class="carousel-inner">
                                
                              <div class="carousel-item active"
                                   th:each="image : ${instaArticleList.instaArticleImgDtoList}"> 
                                   <img th:src="|/images/${image.img_link}|" class="d-block w-100">
                              </div>
                            </div>
                            <button class="carousel-control-prev" type="button" th:data-bs-target="'#carouselExampleInterval' + ${instaArticleList.instaArticleDto.id}" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" th:data-bs-target="'#carouselExampleInterval' + ${instaArticleList.instaArticleDto.id}" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Next</span>
                            </button>
                          </div>
                    </div>
                </div> -->


                <div class="row" style="height: 30px;">
                    <!-- 좋아요 -->
                    <div class="col-auto px-0" th:if="${instaArticleList.like == 1}">
                        <form action="./pushArticleLikeDeleteProcess" method="get">
                            <button class="btn">
                                <i class="fa-solid fa-heart"></i>
                            </button>

                            <input type="hidden" name="user_id" th:value="${session.sessionUserInfo.id}">
                            <input type="hidden" name="article_id" th:value="${instaArticleList.instaArticleDto.id}">
                        </form>
                    </div>
                    <div class="col-auto px-0" th:if="${instaArticleList.like != 1}">
                        <form action="./pushArticleLikeProcess" method="get">
                            <button class="btn">
                                <!-- onclick="like(/*[[${instaArticleList.instaArticleDto.id}]]*/)" -->
                                <i id="heart" onclick="like()" class="fa-regular fa-heart"></i>

                                <input type="hidden" name="user_id" th:value="${session.sessionUserInfo.id}">
                                <input type="hidden" name="article_id" th:value="${instaArticleList.instaArticleDto.id}">
                            </button>
                        </form>
                    </div>

                    <!-- 댓글 -->
                    <div class="col px-0">
                        <form action="./commentWritePage" method="get">
                            <button class="btn px-0">
                                <i class="fa-regular fa-comment"></i>
                            </button>
                            <input type="hidden" name="user_id" th:value="${session.sessionUserInfo.id}">
                            <input type="hidden" name="article_id" th:value="${instaArticleList.instaArticleDto.id}">
                        </form>
                    </div>

                    <!-- 북마크 -->
                    <div class="col text-end">
                        <form action="./pushBookmarkProcess" method="get">
                            <button class="btn pe-0">
                                <i class="fa-regular fa-bookmark"></i>
                            </button>
                        </form>
                    </div>
                    <!-- <div class="col text-end">
                        <form action="./pushBookmarkDeleteProcess" method="get">
                            <button class="btn pe-0">
                                <i class="fa-solid fa-bookmark"></i>
                            </button>
                        </form>
                    </div> -->
                </div>

                <!-- 좋아요 수 -->
                <div class="row">
                    <a class="col fontBasic link-dark link-offset-2 link-underline link-underline-opacity-0 " href="./pushLikeUserPage">
                        <span>좋아요</span>
                        <span th:text="${instaArticleList.likeCount}"></span><span>개</span>
                    </a>
                </div>

                <!-- 글 작성한 사람 닉네임,
                     게시글 작성일,
                     내용 -->
                <div class="row justify-content-center">
                    <!-- <a class="col-auto fontBasic pe-0 link-dark link-offset-2 link-underline link-underline-opacity-0" href="./instaUserPage">
                        <span th:text="${instaArticleList.instaUserInfoDto.insta_nickname}"></span>
                    </a> -->
                    <a class="col-auto d-flex align-items-center pe-0 link-dark link-offset-2 link-underline link-underline-opacity-0"
                                th:href="${session.sessionUserInfo.id == instaArticleList.instaUserInfoDto.user_id} ?
                                            @{./instaMyPage(user_id=${instaArticleList.instaUserInfoDto.id})} : @{./instaUserPage(user_id=${instaArticleList.instaUserInfoDto.id})}">
                        <!-- <span class="fontBasic">saram</span> -->
                        <span th:text="${instaArticleList.instaUserInfoDto.insta_nickname}" style="font-size: 0.8em;"></span>
                    </a>
                    <div class="col-auto fontBasic ps-1 pe-0">
                        <span th:text="${T(com.bulmeong.basecamp.common.util.TimeUtil).timeAgo(instaArticleList.instaArticleDto.created_at)}" style="color: rgb(162, 162, 162); font-size: 0.9em;"></span>                                             
                    </div>
                    <div class="col ps-1 fontBasic">
                        <span th:text="${instaArticleList.instaArticleDto.content}" style="font-size: 0.92em;">good day✨</span>   
                    </div>
                </div>

                <!-- 댓글 -->
                <div class="row">
                    <a class="col link-dark link-offset-2 link-underline link-underline-opacity-0"
                        th:href="@{./commentWritePage(user_id=${session.sessionUserInfo.id}, article_id=${instaArticleList.instaArticleDto.id})}">
                        <span class="fontBasic" style="color: rgb(162, 162, 162);">댓글
                            <span th:text="${instaArticleList.commentCount}"></span>개 모두 보기
                        </span>
                    </a>
                </div>

                <!-- 댓글 작성 -->
                <div class="row">
                    <div class="col-auto pe-0">
                        <!-- 로그인한 유저 프로필 -->
                        <!-- <img th:src="|/basecampImage/${session.instaUserInfoDto.insta_profile_img}|" class="img-fluid rounded-circle commentImage"> -->
                        <img src="/public/img/instaImage/hahaha4.jpg" class="img-fluid rounded-circle commentImage">
                    </div>
                    <a class="col ps-1 link-dark link-offset-2 link-underline link-underline-opacity-0"
                        th:href="@{./commentWritePage(user_id=${session.sessionUserInfo.id}, article_id=${instaArticleList.instaArticleDto.id})}">
                        <span class="fontBasic" style="color: rgb(162, 162, 162);">댓글 달기...</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- <div class="write-button-container">
            <form action="./instaWritePage" method="get">
                <button class="btn write-button" type="submit" style="background-color: white;">
                    <i class="bi bi-plus-square fs-2"></i>
                </button>
            </form>
        </div> -->

        <!-- 글쓰기 버튼 -->
        <div class="write-button-container">
            <!-- style="aspect-ratio: 1/1;" -> 익스펙토 주문 : 정방향을 만들어준다 -->
            <form action="./instaWritePage" method="get">
                <button class="btn bg-white rounded-2 border border-2 border-black px-2 py-1" type="submit">
                    <i class="fa-solid fa-plus"></i>
                    <input type="hidden" name="user_id" th:value="${instaUserInfoDto.id}">
                </button>
            </form>
        </div>

        <!-- 글쓰기 페이지 -->
        <!-- <form class="row fixed-bottom fixed-write-button" action="./instaWritePage" method="get">
            <div class="col-10"></div>
            <div class="col-2">
                <button class="btn" type="submit">
                    <i class="bi bi-plus-square fs-2 write-button"></i>
                </button>
            </div>
        </form> -->
        
    </div>

    <div class="container mt-5 pt-5">
        <!-- 하단바 -->
        <div class="row">
            <div class="col">
                <div class="row border-top fixed-bottom" style="background-color: white;">

                    <div class="col">
                        <button onclick="popup(`당신의 선택은`,`과연`,`자바스크립트`,`타임리프`,function(){action()})" class="btn" type="submit">
                            <span>홈</span>
                        </button>
                    </div>
                        
                    <div class="col">
                        <span>쇼핑</span>
                    </div> 
                    <div class="col">
                        <span>예약</span>
                    </div> 
                    <div class="col">
                        <span>커뮤</span>
                    </div> 
                    <div class="col">
                        <span>마이</span>
                    </div> 
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/7b271bba58.js" crossorigin="anonymous"></script>
</body>
</html>
