<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>날짜 시간 선택</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .scroll-picker {
            display: flex;
            justify-content: space-between;
            max-width: 300px;
            margin: 20px auto;
        }
        .scroll-picker select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            text-align: center;
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 0 5px;
            height: 6.5rem; /* 선택 상자의 높이 지정 (3개 항목만 보이도록) */
            overflow-y: auto; /* 스크롤이 가능하게 설정 */
        }
        .scroll-picker select::-ms-expand {
            display: none;
        }
        .scroll-picker-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="scroll-picker-container">
    <h3>대여 시각</h3>
    <div class="scroll-picker">
        <select id="startDate">
            <!-- JavaScript에서 날짜 옵션 추가 -->
        </select>
        <select id="startHour">
            <!-- JavaScript에서 시간 옵션 추가 -->
        </select>
        <select id="startMinute">
            <!-- JavaScript에서 분 옵션 추가 -->
        </select>
    </div>

    <h3>반납 시각</h3>
    <div class="scroll-picker">
        <select id="endDate">
            <!-- JavaScript에서 날짜 옵션 추가 -->
        </select>
        <select id="endHour">
            <!-- JavaScript에서 시간 옵션 추가 -->
        </select>
        <select id="endMinute">
            <!-- JavaScript에서 분 옵션 추가 -->
        </select>
    </div>

    <button id="reserveButton" class="btn btn-primary">예약하기</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const reservedDates = ['2024-08-29', '2024-08-30'];

        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = Math.ceil(now.getMinutes() / 10) * 10;
            return {
                hours: hours,
                minutes: minutes
            };
        }

        function populateDateOptions(selectElement, startDate, daysToAdd) {
            for (let i = 0; i < daysToAdd; i++) {
                const optionDate = new Date(startDate);
                optionDate.setDate(startDate.getDate() + i);

                const year = optionDate.getFullYear();
                const month = optionDate.getMonth() + 1;
                const day = optionDate.getDate();
                const dayOfWeek = optionDate.toLocaleDateString('ko-KR', { weekday: 'short' });

                const optionText = `${year}. ${month}. ${day}. (${dayOfWeek})`;
                const optionValue = optionDate.toISOString().split('T')[0];

                const option = document.createElement('option');
                option.value = optionValue;
                option.textContent = optionText;

                if (reservedDates.includes(optionValue)) {
                    option.disabled = true;
                    option.textContent += " (예약됨)";
                }

                selectElement.appendChild(option);
            }
        }

        function populateHourOptions(selectElement, currentHour) {
            for (let i = 0; i < 24; i++) {
                const optionText = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = i;
                option.textContent = optionText;
                if (i === currentHour) {
                    option.selected = true;
                }
                selectElement.appendChild(option);
            }
        }

        function populateMinuteOptions(selectElement, currentMinute) {
            for (let i = 0; i < 60; i += 10) {
                const optionText = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = i;
                option.textContent = optionText;
                if (i === currentMinute) {
                    option.selected = true;
                }
                selectElement.appendChild(option);
            }
        }

        const currentTime = getCurrentTime();
        const startDate = new Date();

        // 10년치 날짜 추가
        populateDateOptions(document.getElementById('startDate'), startDate, 365 * 10);
        populateDateOptions(document.getElementById('endDate'), startDate, 365 * 10);
        populateHourOptions(document.getElementById('startHour'), currentTime.hours);
        populateHourOptions(document.getElementById('endHour'), currentTime.hours);
        populateMinuteOptions(document.getElementById('startMinute'), currentTime.minutes);
        populateMinuteOptions(document.getElementById('endMinute'), currentTime.minutes);

        function adjustEndTime() {
            const startDate = document.getElementById('startDate').value;
            const startHour = parseInt(document.getElementById('startHour').value, 10);
            const startMinute = parseInt(document.getElementById('startMinute').value, 10);

            const endDate = document.getElementById('endDate').value;
            const endHour = parseInt(document.getElementById('endHour').value, 10);
            const endMinute = parseInt(document.getElementById('endMinute').value, 10);

            const startTime = new Date(`${startDate}T${startHour.toString().padStart(2, '0')}:${startMinute.toString().padStart(2, '0')}`);
            const endTime = new Date(`${endDate}T${endHour.toString().padStart(2, '0')}:${endMinute.toString().padStart(2, '0')}`);

            if (endTime < startTime || new Date(endDate) < new Date(startDate)) {
                document.getElementById('startDate').value = endDate;
                document.getElementById('startHour').value = endHour;
                document.getElementById('startMinute').value = endMinute;
            }
        }

        function isDateReserved(date) {
            return reservedDates.includes(date);
        }

        function isBetweenReservedDates(startDate, endDate) {
            const reservedDatesParsed = reservedDates.map(date => new Date(date));
            const start = new Date(startDate);
            const end = new Date(endDate);

            return reservedDatesParsed.some(date => date >= start && date <= end);
        }

        document.getElementById('endDate').addEventListener('change', adjustEndTime);
        document.getElementById('endHour').addEventListener('change', adjustEndTime);
        document.getElementById('endMinute').addEventListener('change', adjustEndTime);

        document.getElementById('reserveButton').addEventListener('click', function() {
            const startDate = document.getElementById('startDate').value;
            const startHour = document.getElementById('startHour').value;
            const startMinute = document.getElementById('startMinute').value;

            const endDate = document.getElementById('endDate').value;
            const endHour = document.getElementById('endHour').value;
            const endMinute = document.getElementById('endMinute').value;

            const startDateTime = new Date(`${startDate}T${startHour.toString().padStart(2, '0')}:${startMinute.toString().padStart(2, '0')}`);
            const endDateTime = new Date(`${endDate}T${endHour.toString().padStart(2, '0')}:${endMinute.toString().padStart(2, '0')}`);

            if (isBetweenReservedDates(startDate, endDate)) {
                alert("이미 예약된 사용자가 있어 예약 할 수가 없습니다. 다른 날짜를 선택해주세요.");
            } else {
                alert(`대여 시각: ${startDate} ${startHour}:${startMinute}\n반납 시각: ${endDate} ${endHour}:${endMinute}`);
            }
        });
    });
</script>

</body>
</html>
