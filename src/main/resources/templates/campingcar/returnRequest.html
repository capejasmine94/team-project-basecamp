<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org:">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>차량 반납 요청</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
     <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link href="/public/css/common.css" rel="stylesheet">
    <link href="/public/css/basecamp.css" rel="stylesheet">
    <script src="/public/js/lockLikeMobile.js"></script>
    <link rel="shotcut icon" href="/public/img/common/campFire.ico" type="image/x-icon">
    
    <style>
        body {
            margin: 0;
            padding: 0;

        }
        .section {
            margin-bottom: 0.96px;
            padding: 16px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            -ms-overflow-style: none;
            scrollbar-width:none;
        }
        .section::webkit-scrollbar {
            display: none;
        }

        .section img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .section-text {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
        }
        .highlight-text {
            color: #ff5e57;
            font-weight: bold;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }
        .info-item:last-child {
            border-bottom: none;
        }
        .info-item-title {
            color: #333;
            font-weight: 600;
            font-size:20px;
        }
        .info-item-value {
            color: #555;
        }

        .btn-active .material-symbols-outlined, 
        .btn-active span {
            color: #00B8FF !important; /* 버튼 클릭 후 텍스트 및 아이콘 색상 */
        }
        .error-message {
            color: red;
            font-size: 12px;
            display: none;
            margin-top: 4px;
        }

    </style>
</head>
<body>
    <div class="container-fluid fixed-top">
        <div class="row bg-white align-items-center py-2 border-bottom">
            <div class="col-auto px-0">
                <button class="border-0 bg-transparent d-flex align-items-center text-dark">
                    <span class="material-symbols-outlined" onclick="history.back();" style="cursor: pointer;">arrow_back</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container-fluid" style="margin-top: 56px;">
        <div class="row">
            <div class="col">
                <div class="row">
                    <div class="col text-start fs-2 fw-semibold">
                        <span>반납 요청</span>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col section">
                        <div class="row">
                            <div class="col new-fs-95">
                                <span class="fw-medium" th:text="${rentCarData.garage_address}"></span><span class="fw-normal">에 반납 요청하신게 맞으신가요?</span>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6 text-end d-flex justify-content-end">
                                <button class="btn bg-white text-body-tertiary d-flex align-items-center border border-0" id="yes" onclick="toggleButton('yes', 'no')">
                                    <span class="material-symbols-outlined">check</span><span>네</span>
                                </button>    
                            </div>
                            <div class="col-6 tex-end d-flex justify-content-end">
                                <button class="btn bg-white text-body-tertiary d-flex align-items-end border border-0" id="no" onclick="toggleButton('no', 'yes')">
                                    <span class="material-symbols-outlined">check</span><span>아니요</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col section">
                        <div class="row">
                            <div class="col new-fs-95">
                                <span class="fw-medium">반납 전 마지막 확인</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col new-fs-95">
                                <div class="row mt-2">
                                    <div class="col-8 d-flex align-items-center">
                                        <div>개인 소지품은 모두 챙겼나요?</div>
                                    </div>
                                    <div class="col tex-end d-flex justify-content-end">
                                        <button class="btn bg-white text-body-tertiary d-flex align-items-center border-0" id="personalItem" onclick="yesButton('personalItem')">
                                            <span class="material-symbols-outlined">check</span><span>네</span>
                                        </button>  

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div id="personalItemError" class="error-message"></div>
                                    </div>
                                </div>
                        
                                <div class="row">
                                    <div class="col-8 d-flex align-items-center">
                                        <span>차량 내부 모두 확인 하셨나요?</span>
                                    </div>
                                    <div class="col tex-end d-flex justify-content-end">
                                        <button class="btn bg-white text-body-tertiary d-flex align-items-center border-0" id="interiorCheck" onclick="yesButton('interiorCheck')">
                                            <span class="material-symbols-outlined">check</span><span>네</span>
                                        </button>  
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <div id="interiorCheckError" class="error-message"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-8 d-flex align-items-center">
                                        <span>오수통은 모두 비웠나요?</span>
                                    </div>
                                    <div class="col tex-end d-flex justify-content-end">
                                        <button class="btn bg-white text-body-tertiary d-flex align-items-center border-0" id="wasteTank" onclick="yesButton('wasteTank')">
                                            <span class="material-symbols-outlined">check</span><span>네</span>
                                        </button>  
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div id="wasteTankError" class="error-message"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-8 d-flex align-items-center">
                                        <span>차량 창문은 모두 닫았나요?</span>
                                    </div>
                                    <div class="col tex-end d-flex justify-content-end">
                                        <button class="btn bg-white text-body-tertiary d-flex align-items-center border-0" id="windowCheck" onclick="yesButton('windowCheck')">
                                            <span class="material-symbols-outlined">check</span><span>네</span>
                                        </button>  
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div id="windowCheckError" class="error-message"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid fixed-bottom" style="z-index: 1030;">
        <div class="row">
            <div class="col d-grid px-0">
                <button class="btn btn-bc-light p-3 fw-medium rounded-0" onclick="validateForm()">반납 요청</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="returnRequestModal" tabindex="-1" aria-labelledby="returnRequestModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header border border-0">
              <button type="button"  class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col">
                    <span>판매자가 외부 차량점검중입니다. 점검이 마치면</span><span class="fw-semibold">"반납 차량 외부 점검 동의"</span>에서 확인해주시기 바랍니다.               
                </div>
              </div>
            </div>
            <div class="modal-footer border border-0 d-flex justify-content-center">
                <form method="post" id="approvalForm" th:action="@{/campingcar/reservation_approved}">
                    <input type="hidden" name="progress" value="반납요청">
                    <input type="hidden" name="id" th:value="${rentCarData.id}">
                    <button type="submit" class="btn btn-bc-light px-3">확인</button>
                </form>
            </div>
          </div>
        </div>
      </div>
        
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- 부트스트랩 JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

    <script>
        function toggleButton(yes, no) {
            const activeButton = document.getElementById(yes);
            const otherButton = document.getElementById(no);

            if (activeButton.classList.contains('btn-active')) {
                // 이미 활성화된 버튼을 다시 클릭하면 초기화
                activeButton.classList.remove('btn-active');
                activeButton.classList.add('text-body-tertiary');
            } else {
                // 클릭한 버튼을 활성화하고, 다른 버튼은 비활성화 상태로 유지
                activeButton.classList.add('btn-active');
                activeButton.classList.remove('text-body-tertiary');
                otherButton.classList.remove('btn-active');
                otherButton.classList.add('text-body-tertiary');
            }
        }

        function yesButton(id) {
            const yesButton = document.getElementById(id);

            if (yesButton.classList.contains('btn-active')) {
                // 이미 활성화된 버튼을 다시 클릭하면 초기화
                yesButton.classList.remove('btn-active');
                yesButton.classList.add('text-body-tertiary');
            } else {
                // 버튼을 활성화
                yesButton.classList.add('btn-active');
                yesButton.classList.remove('text-body-tertiary');
            }
        }

        function validateForm() {
            // 유효성 검사를 해야 하는 버튼 ID와 에러 메시지 ID를 매핑한 배열
            const checks = [
                { buttonId: 'personalItem', errorId: 'personalItemError' },
                { buttonId: 'interiorCheck', errorId: 'interiorCheckError' },
                { buttonId: 'wasteTank', errorId: 'wasteTankError' },
                { buttonId: 'windowCheck', errorId: 'windowCheckError' }
            ];

            // 폼이 유효한지 여부를 추적하는 변수
            let isValid = true;

            // 각 버튼에 대해 유효성 검사 수행
            checks.forEach(check => {
                const button = document.getElementById(check.buttonId);
                const error = document.getElementById(check.errorId);

                // 버튼이 활성화되지 않은 경우
                if (!button.classList.contains('btn-active')) {
                    error.innerText = '* "네" 표시를 눌러주세요';
                    error.style.display = 'block';
                    isValid = false; // 폼이 유효하지 않음
                } else {
                    error.style.display = 'none'; // 에러 메시지 숨기기
                }
            });

            // 모든 유효성 검사를 통과한 경우 모달 표시
            if (isValid) {
                showModal();
            }
        }



          // 모달 열기 함수
          const showModal = () => {
            const returnRequestModal = document.getElementById('returnRequestModal');
            const modal = new bootstrap.Modal(returnRequestModal);

            const submitButton = returnRequestModal.querySelector('button[type="submit"]');
            if (!submitButton.dataset.listenerAdded) {
                submitButton.addEventListener('click', function(event) {
                    event.preventDefault(); // 기본 동작 중지
                    document.getElementById('approvalForm').submit(); // 폼 제출
                });
                submitButton.dataset.listenerAdded = true;
            }

            modal.show();
        };
    </script>
    
      
</body>
</html>
