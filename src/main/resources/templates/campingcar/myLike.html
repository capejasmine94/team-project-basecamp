<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org:">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/7b271bba58.js" crossorigin="anonymous"></script>
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link href="/public/css/common.css" rel="stylesheet">
    <link href="/public/css/basecamp.css" rel="stylesheet">
    <script src="/public/js/lockLikeMobile.js"></script>
    <link rel="shotcut icon" href="/public/img/common/campFire.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .section {
            margin: 1.5rem 1rem;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            background-color: #fff;
            border: 1px solid #e0e0e0;
        }
        .section img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .section-text {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
        }
        .highlight-text {
            color: #ff5e57;
            font-weight: bold;
        }
        .final-price {
            font-size: 24px;
            font-weight: bold;
            color: #007aff;
            text-align: center;
            margin-bottom: 16px;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }
        .info-item:last-child {
            border-bottom: none;
        }
        .info-item-title {
            color: #333;
            font-weight: bold;
        }
        .info-item-value {
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row bg-white pt-2 pe-1 justify-content-end">
            <div class="col bg-white py-2 ps-3">
                <div class="fs-2 fw-medium">위시리스트</div>
            </div>
            <div class="col-auto">
                <i class="bi bi-x-lg fs-2" onclick="goToMainPage()"></i>
            </div>
        </div>  
    </div>

    <!-- 켐핑카 필터 -->
    <div class="container-fluid py-2 mt-3">
        <div class="row px-3" th:each="myLike : ${MyLikeList}">
            <a th:href="@{/campingcar/campingCarDetailPage(id=${myLike.id})}" class="col px-0 shadow rounded-4 my-4">
                <div class="row mx-0">
                    <div class="col px-0 d-flex justify-content-center align-items-center overflow-hidden rounded-top-4 position-relative">
                        <img th:src="|/images/${myLike.main_img}|" class="img-fluid" style="max-width: 100%; min-height: 100%;" alt="썸네일">
                        <div class="position-absolute top-0 end-0 pt-1" style="padding-right: 0.75rem;">
                            <i id="heart-${myLike.id}" th:onclick="'like(' + ${myLike.id} + ')'" class="fa-regular fa-heart" style="color: #ff0000;"></i>
                        </div>
                    </div>
                </div>
                <div class="row px-3">
                    <div class="col">
                        <!-- 회사명 + 차량명 -->
                        <div class="row">
                            <div class="col pe-0 pb-2">
                                <span th:text="${myLike.comp_name}" class="fw-bold fs-6 text-success"></span>
                                <span th:text="${myLike.product_name}" class="fw-bold fs-6" style="color: #484647;"></span>
                            </div>
                        </div>
                        <!-- 비수기 평일가격, 주말가격 -->
                        <div class="row ps-1 d-flex align-items-between">
                            <div class="col-auto fs-6 ps-2 pb-2 d-flex align-items-center">
                                <span class="text-dark fw-semibold pe-1">평일 :</span>
                                <span class="lightFont fw-medium" th:text="${#numbers.formatInteger(myLike.rental_fee_weekdays, 3, 'COMMA')}+'원'"></span>
                            </div>
                            <div class="col-2 px-0"></div>
                            <div class="col-auto fs-6 px-0 pb-2 d-flex justify-content-center align-items-center">
                                <span class="text-dark fw-semibold pe-1">주말 :</span>
                                <span class="lightFont fw-medium" th:text="${#numbers.formatInteger(myLike.rental_fee_weekend, 3, 'COMMA')}+'원'"></span>
                            </div>
                        </div>
                        <!-- 차고지 주소 + 운전 조건 -->
                        <div class="row border-top d-flex-items-between">
                            <div class="col-12 pt-2 pb-2 fw-bold new-fs-8" style="color: #7C7B7B;">
                                <div class="d-flex align-items-center">
                                    <div th:text="'차고지 : ' + ${myLike.garage_address}"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 pb-2 pe-0 fw-bold new-fs-8" style="color: #7C7B7B;">
                                <div class="d-flex align-items-center flex-wrap gap-2">
                                    <div th:text="'운전면허증 : ' + ${myLike.driver_license_condition_name} + ' |'"></div>
                                    <div th:text="'운전자 나이 : ' + ${myLike.driver_age_condition_name} + ' |'"></div>
                                    <div th:text="'운전자 경력 : ' + ${myLike.driver_experience_condition_name}"></div>
                                </div>
                            </div>
                        </div>
                        <!-- 동승, 취침, 애완 조건 -->
                        <div class="row py-2 new-fs-7 border-top">
                            <div class="col px-2 d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <span class="material-symbols-outlined pe-1 fs-5">groups</span>
                                    <span class="text-center pe-2" th:text="'동승 인원 ' + ${myLike.seating_capacity} + '명'"></span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="material-symbols-outlined pe-1 fs-5">hotel</span>
                                    <span class="text-center pe-0" th:text="'취침 인원 ' + ${myLike.sleeping_capacity} + '명'"></span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="material-symbols-outlined ps-2 new-fs-9">Pets</span>
                                    <span class="text-center pe-0" th:text="' 반려 동물  ' + ${myLike.pet_friendly}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- 모든 리스트가 출력된 후에 메시지를 출력 -->
    <div class="container">
        <div class="row text-center pb-4">
            <div class="col">
                <span class="text-body-tertiary">모든 내용을 불러왔습니다.</span>
            </div>
        </div>
    </div>    

    <!-- footer -->
    <div th:replace="~{campingcar/campingNavi::footerNavi}"></div>
    <!-- bottom -->
    <div th:replace="~{campingcar/campingNavi::bottomNaviBasecamp}"></div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script>
    function goToMainPage() {
        window.location.href = '/campingcar/main';
    }
    document.addEventListener("DOMContentLoaded", function() {

        // 페이지 로드 시 좋아요 상태를 확인하고 업데이트합니다.
        document.querySelectorAll('[id^="heart-"]').forEach(function(heartIcon) {
            const productId = heartIcon.id.split('-')[1];
            checkLikeStatus(productId);
        });

        function like(productId) {
            const heartIcon = document.getElementById(`heart-${productId}`);
            const isLiked = heartIcon.classList.contains('fa-solid');
            
            if (isLiked) {
                // 좋아요를 취소하는 API 호출
                fetch(`/api/rent-user/unlike?product_id=${productId}`, {
                    method: 'POST'
                }).then(() => {
                    heartIcon.classList.remove('fa-solid');
                    heartIcon.classList.add('fa-regular');
                });
            } else {
                // 좋아요를 추가하는 API 호출
                fetch(`/api/rent-user/like?product_id=${productId}`, {
                    method: 'POST'
                }).then(() => {
                    heartIcon.classList.remove('fa-regular');
                    heartIcon.classList.add('fa-solid');
                });
            }
        }

        function checkLikeStatus(productId) {
            const url = `/api/rent-user/isLiked?product_id=${productId}`;
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json(); // 이 라인에서 문제가 발생할 수 있음
                })
                .then(data => {
                    const heart = document.getElementById(`heart-${productId}`);
                    if (data.isLikedByUser) {
                        heart.classList.remove("fa-regular");
                        heart.classList.add("fa-solid");
                        heart.setAttribute("onclick", `like(${productId}, event)`);
                    } else {
                        heart.classList.remove("fa-solid");
                        heart.classList.add("fa-regular");
                        heart.setAttribute("onclick", `like(${productId}, event)`);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

    });
    </script>
</body>
</html>
